<h1 id="animator_access_generator">Animator Access Generator</h1>

<p>Code generator utility for Unity game engine. Creates a class to conveniently access <a href="http://docs.unity3d.com/ScriptReference/Animator.html">Animator</a> 
states and parameters. The goal is to facilitate access to Animator states and parameters. Further on encapsulting 
access through dedicated methods makes it possible to detect potential problems and inconsistencies already at compile time. </p>

<h2 id="quick_start">Quick Start</h2>

<h3 id="installation">Installation:</h3>

<ul>
<li>Unity 4.3 is needed</li>
<li>Download the current stable release <a href="https://github.com/kayy/AnimatorAccess/archive/Current.zip">AnimatorAccess.zip</a> from GitHub</li>
<li>Unzip and copy all files to some location under your Assets directory but <strong>NOT under any editor directory</strong>.</li>
</ul>

<h3 id="generating_code">Generating Code:</h3>

<ul>
<li>In the hierachy view select a game object that contains an Animator component having a valid controller</li>
<li>Go to the new menu item <strong>Animator Access</strong> / <strong>Create Animator Access</strong></li>
<li>Choose a file name and the output directory where to place the C# file (has to be under Assets directory)</li>
<li>Say <em>Yes</em> when the dialog appears about adding the component to the game object.</li>
</ul>

<h3 id="usage_example">Usage example</h3>

<p>Setup (related to provided ExampleScene.unity):</p>

<ul>
<li>Game object <strong>ExamplePlayer</strong> contains an Animator component</li>
<li>Generated class is <strong>ExamplePlayerAnimatorAccess.cs</strong></li>
<li>Another component <strong>Player</strong> is attached to this game object too. It uses ExamplePlayerAnimatorAccess in its 
FixedUpdate method to control animations </li>
<li>Animator states are:
<ul>
<li><strong>Idle</strong>, <strong>Jumping</strong>, <strong>Walking</strong> and <strong>Yawning</strong> in layer 0 (<strong>Base Layer</strong>)</li>
<li><strong>Centered</strong>, <strong>Rotate-Left</strong> and <strong>Rotate-Right</strong> in layer 1 (<strong>Rot</strong>)</li>
</ul></li>
<li>Animator parameters are:
<ul>
<li><strong>JumpTrigger</strong> (trigger) and </li>
<li><strong>YawnTrigger</strong> (trigger) and </li>
<li><strong>Rotate</strong> (int) and </li>
<li><strong>Speed</strong> (float)</li>
</ul></li>
</ul>

<p>To use <strong>ExamplePlayerAnimatorAccess</strong> define a member in <strong>Player.cs</strong> and assign a reference in Awake ():</p>

<pre><code>AnimatorAccess.ExamplePlayerAnimatorAccess anim;

void Awake () {
    anim = GetComponent < AnimatorAccess.ExamplePlayerAnimatorAccess > ();
</code></pre>

<p>Now you have convenient access to all parameters and animator states. Aside from using parameter and state hash IDs 
directly, there are predefined methods for querying the state (prefix <strong>Is</strong>) and <strong>Get</strong> and <strong>Set</strong> methods to access 
parameters in a type safe way like <strong>IsWalking ()</strong> <strong>SetSpeed ()</strong>:</p>

<pre><code>void FixedUpdate () {
    currentState0 = animator.GetCurrentAnimatorStateInfo (0).nameHash;
    if (anim.IsWalking (currentState0)) {
        // set speed 
        anim.SetSpeed (speed);
        // alternatively you can use hash IDs directly but this is more cumbersome:
        // animator.SetFloat (anim.paramIdSpeed, speed);
</code></pre>

<h2 id="concept_and_workflow">Concept And Workflow</h2>

<h3 id="basic_idea">Basic Idea</h3>

<p>Whenever you have made any changes in the Animator window like adding, renaming or deleting states or parameters, 
you should update the animator access component. Animator Access Generator analyses the existing version of the
component to be generated and works with a <strong>two-step</strong> procedure to handle changes:</p>

<ul>
<li>Previously valid members (i.e. Animator parameters and states) are detected and marked with the <em>Obsolete</em> attribute</li>
<li>Those members in the previous version that were already marked as <em>Obsolete</em> will be removed</li>
</ul>

<p>The basic idea is to give you the chance to refactor your code without having uncompileable code. If there are any 
references to members that are not valid any longer, obsolete warnings guide you where you have to make changes:</p>

<p>(<em>CS0168: Animator state or parameter is no longer valid and will be removed in the next code generation&#8230;</em>) .</p>

<h3 id="workflow_using_the_custom_editor">Workflow Using The Custom Editor</h3>

<p>The generated component has a custom inspector window:</p>

<p><img src="./Doc/AnimatorAccess_CustomEditor_Example.png" alt="Custom Editor up to date" title="" /></p>

<p>The status is updated every 30 seconds automatically. Use the <em>Check</em> button to force a status update immediately.
<em>Check</em> will not perform any changes but is meant to preview what will happen on an update. Hovering the mouse 
over an entry will show a tooltip with more information</p>

<p>Supposed we made 3 changes:
A new state <strong>Running</strong>, New trigger parameter <strong>LookUp</strong> and renaming of parameter <strong>Rotate</strong> to <strong>RotateTo</strong></p>

<p>This will look like:</p>

<p><img src="./Doc/AnimatorAccess_CustomEditor_Example-2.png" alt="Custom Editor having changes" title="" /></p>

<ol>
<li>New field <strong>stateIdRunning</strong> and an <strong>IsRunning ()</strong> method for <strong>Running</strong></li>
<li>Field <strong>paramIdLookUp</strong> and <strong>SetLookup ()</strong> method for <strong>LookUp</strong> (triggers don&#8217;t have Get methods)</li>
<li>Field and methods for <strong>RotateTo</strong> including a Get method as this is an int</li>
<li>The code of the previously named parameter <strong>Rotate</strong> will be marked as obsolete i.e. <strong>paramIdRotate</strong>,
<strong>GetRotate</strong> and <strong>SetRotate</strong>.</li>
</ol>

<p>Push the <em>Update</em> button to perform the changes and regenerate the component&#8217;s source code. Note that the changes are
not refreshed automatically. Most often you will like to first view and adopt the changes in MonoDevelop and then run
your game in Unity.</p>

<p>The <em>Refresh</em> button forces Unity to reload the changes from disk (s. <em>Advance Topics</em> on automatic refreshing).</p>

<p><em>Undo</em> performs a roll back to the previous version. Note that there is only one backup saved. Again there is no
automatic refresh so push <em>Refresh</em> after Undo.</p>

<h2 id="using_the_generated_code_in_monodevelop">Using The Generated Code in MonoDevelop</h2>

<p>See the Quick Start section above or find more details in the provided <em>ExampleScene</em> in the <em>Example</em> folder.</p>

<p>Although generated code should not be edited, it can be pretty useful to do so temporarily to quickly update your
other code.</p>

<h3 id="efficient_handling_of_warnings">Efficient Handling of Warnings</h3>

<p>If you rename Animator parameters, states or layers that are referenced in your own code, you will get warnings
about using obsolete members. While single occurrences are easy to maintain, renaming of a widely used parameter
would be painful to replace in code.</p>

<p>To do this more efficiently use refactoring and rename the <strong>obsolete</strong> member to the new name. Suppose there are
several calls to <strong>SetRotate</strong> in the example above. We want to change all these calls at once to point to the new 
method <strong>SetRotateTo</strong>:</p>

<p>Go to the <strong>obsolete</strong> method <strong>SetRotate (int newValue)</strong> in the newly generated file <strong>ExamplePlayerAnimatorAccess.cs</strong>
and rename it to <strong>SetRotateTo</strong>.</p>

<p><img src="./Doc/MonoDev_Refactoring.png" alt="Custom Editor having changes" title="" /></p>

<p>Yes, there is already our new method SetRotateTo having exactly the same signature and now we have two of them. But 
that&#8217;s the clue: After renaming is done, simple delete the <strong>obsolete</strong> version - ready. Now all references point 
to the correct method.</p>

<h3 id="errors_in_monodevelop">Errors in MonoDevelop</h3>

<p>There are three known situations when you may get errors:  </p>

<ol>
<li>Obsolete warnings were ignored and the next <em>Update</em> was triggered. Then all obsolete members are removed and 
references to these will fail</li>
<li>You changed state and parameter hash prefix settings to contain the same string, removed a parameter and 
create a state with the same name</li>
<li>Generated code was edited so that a naming conflict arose.</li>
</ol>

<p>If <em>Undo</em> does not help, most problems can be solved pretty similar the way we handled warnings. Do single changes 
manually and a bunch of changes with the refactoring strategy. If there are many places referring to a missing 
member, manually introduce it as dummy and then use refactoring. </p>

<h2 id="naming_convention_and_customising">Naming Convention And Customising</h2>

<p>You can customise the way how to generate parameter and method names in the <em>Settings</em> window. All access methods
start with <strong>Is</strong>, <strong>Get</strong> or <strong>Set</strong>. This cannot be changed but the pattern for the appended item name can be 
modified. You can for example define that all animator state query methods (Is&#8230;) contain the prefix <em>State</em> 
before the name e.g. IsStateIdle ().</p>

<p>Be careful with changes for the hash ID member variables prefixes. States and parameters should have <strong>different 
prefixes</strong> to avoid naming conflicts.</p>

<p>By default the <strong>Layer name</strong> is ignored for layer 0 and prepended for all other layers.</p>

<p><strong>Avoid non-ANSI characters</strong>. Field names are converted to match the pattern [a-z_][a-zA-Z0-9_]. Non-matching 
characters are changed to an underscore.</p>

<p>Look at the tooltips in the <em>Settings</em> windows or go to <a href="./Doc/README-Advanced.md">README-Advanced.md</a> for a complete 
description.</p>

<h2 id="advanced_topics">Advanced Topics</h2>

<p>See <a href="./Doc/README-Advanced-HTML.html#animator-access-generator-advanced-topics">README-Advanced.md</a> for more about:</p>

<ul>
<li>Configuration via Settings window</li>
<li>Persistent Storage Location</li>
<li>SmartFormat Template</li>
<li>Moving Animator Access Menu</li>
<li>File Specific Configuration</li>
</ul>
